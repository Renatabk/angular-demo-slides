<div class="center">
<div class="slide">
<h2>Refactor for testability</h2>
<pre class="code-only">
var SERVICE_URL = 'http://angularjs.org/' +
 'generatePassword.php?callback=JSON_CALLBACK';

// extract method
function passwordMain(){
  // get references to DOM elements
  var input = $(':input[type=password]');
  var show = $(':checkbox');
  var strength = $('.strength');
  var password = $('.password');
  var button = $(':button');
  var grade;

  // Register behavior
  button.bind('click', function(){
    var r = $.ajax({
      url:SERVICE_URL,
      complete:function(response){
        input.val(response.password);
        change();
      }
    });
  });

  input.bind('keydown', function(){
    setTimeout(change, 0);
  });

  show.bind('click', function(){
    if (show.is(':checked')) {
      password.show();
    } else {
      password.hide();
    }
  });

  function change(){
    strength.removeClass(grade);
    var pwd = input.val();
    password.text(pwd);
    if (pwd.length > 8) {
      grade = 'strong';
    } else if (pwd.length > 3) {
      grade = 'medium';
    } else {
      grade = 'weak';
    }
    strength
     .addClass(grade)
     .text(grade);
  }

  //reset initial state
  change();
}

// we need to place this bootstrap code someplace
// $(passwordMain);
</pre>
</div>
</div>
